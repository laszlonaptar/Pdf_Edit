<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin – Eintrag #{{ sub['id'] }}</title>
  <link rel="stylesheet" href="/static/style.css?v=13" />
</head>
<body>
  <main class="container">
    <div class="actions-top">
      <a class="btn secondary" href="/admin">← Zurück zur Liste</a>
      <a class="btn" href="/admin/logout">Abmelden</a>
    </div>

    <h1>Eintrag #{{ sub['id'] }}</h1>

    <section class="card">
      <div class="grid-2">
        <div class="field">
          <label>Datum</label>
          <div>{{ sub['datum'] }}</div>
        </div>
        <div class="field">
          <label>Bau</label>
          <div>{{ sub['bau'] }}</div>
        </div>
        <div class="field">
          <label>BASF-Beauftragter</label>
          <div>{{ sub['basf_beauftragter'] or '—' }}</div>
        </div>
        <div class="field">
          <label>Erstellt (UTC)</label>
          <div class="muted">{{ sub['created_at'] }}</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Beschreibung</h2>
      <div style="white-space:pre-wrap">{{ sub['beschreibung'] or '—' }}</div>
    </section>

    <section class="card">
      <h2>Mitarbeiter</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Vorname</th>
              <th>Nachname</th>
              <th>Ausweis/Kennzeichen</th>
              <th>Beginn</th>
              <th>Ende</th>
              <th>Vorhaltung</th>
            </tr>
          </thead>
          <tbody>
            {% set idx = 0 %}
            {% for i in range(1,6) %}
              {% set v = sub['vorname' ~ i] %}
              {% set n = sub['nachname' ~ i] %}
              {% set a = sub['ausweis' ~ i] %}
              {% set b = sub['beginn' ~ i] %}
              {% set e = sub['ende' ~ i] %}
              {% set vh = sub['vorhaltung' ~ i] %}
              {% if v or n or a or b or e or vh %}
                {% set idx = idx + 1 %}
                <tr>
                  <td>{{ idx }}</td>
                  <td>{{ v }}</td>
                  <td>{{ n }}</td>
                  <td>{{ a }}</td>
                  <td>{{ b }}</td>
                  <td>{{ e }}</td>
                  <td>{{ vh }}</td>
                </tr>
              {% endif %}
            {% endfor %}
            {% if idx == 0 %}
              <tr><td colspan="7" class="muted">Keine Mitarbeiterdaten.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <h2>Dateien</h2>
      <ul>
        {% if sub['excel_filename'] %}
          <li>Excel (lokal): <a href="/download/{{ sub['excel_filename'] }}">{{ sub['excel_filename'] }}</a></li>
        {% endif %}
        {% set drive_id = (payload.get('drive_file_id') if payload else None) %}
        {% if drive_id %}
          <li>Google Drive: <a href="https://drive.google.com/file/d/{{ drive_id }}/view" target="_blank" rel="noopener">Megnyitás a Drive-on</a></li>
        {% else %}
          <li class="muted">Nincs Drive fájl ID elmentve ehhez a bejegyzéshez.</li>
        {% endif %}
      </ul>
    </section>
  </main>
</body>
</html>
